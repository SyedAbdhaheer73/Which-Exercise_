<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Which Exercise?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .app {
      background: #020617;
      padding: 28px;
      border-radius: 16px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    .decision {
      margin: 24px 0;
      font-size: 1.9rem;
      font-weight: 700;
    }

    .reason {
      font-size: 0.95rem;
      opacity: 0.85;
      min-height: 3rem;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 1.1rem;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      margin-top: 12px;
    }

    .primary {
      background: #22c55e;
      color: #022c22;
    }

    .secondary {
      background: #334155;
      color: #e5e7eb;
    }

    .meta {
      margin-top: 18px;
      font-size: 0.8rem;
      opacity: 0.6;
    }
  </style>
</head>
<body>

<div class="app">
  <h1>Which Exercise?</h1>

  <div class="decision" id="decision">Decide today</div>
  <div class="reason" id="reason"></div>

  <button class="primary" onclick="decideToday()">
    Decide Today
  </button>

  <button class="secondary" onclick="skipToday()">
    Skip Today (Recovery)
  </button>

  <div class="meta" id="meta"></div>
</div>

<script>
/* =====================
   CONFIG (Phase 1)
===================== */

const MUSCLE_GROUPS = [
  "ARMS", "BACK", "SHOULDER", "ABS", "LEGS", "MOBILITY", "CARDIO"
];

const REST_THRESHOLD = 5;          // days in a row
const SURPRISE_RUN_MIN_DAYS = 28;  // ~ once a month

/* =====================
   STATE HELPERS
===================== */

function loadState() {
  return {
    history: JSON.parse(localStorage.getItem("history") || "[]"),
    lastRestDate: localStorage.getItem("lastRestDate"),
    lastSurpriseRunDate: localStorage.getItem("lastSurpriseRunDate"),
    consecutiveTrainingDays: Number(localStorage.getItem("consecutiveTrainingDays") || 0)
  };
}

function saveState(state) {
  localStorage.setItem("history", JSON.stringify(state.history));
  localStorage.setItem("lastRestDate", state.lastRestDate || "");
  localStorage.setItem("lastSurpriseRunDate", state.lastSurpriseRunDate || "");
  localStorage.setItem("consecutiveTrainingDays", state.consecutiveTrainingDays);
}

function today() {
  return new Date().toISOString().slice(0, 10);
}

function daysSince(date) {
  if (!date) return Infinity;
  return Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
}

/* =====================
   CORE DECISION LOGIC
===================== */

function decideToday() {
  const state = loadState();

  /* 1️⃣ Forced REST */
  if (state.consecutiveTrainingDays >= REST_THRESHOLD) {
    recordDecision(state, "REST", "Recovery");
    show("REST",
      "You’ve trained several days in a row. Full rest supports recovery and consistency."
    );
    state.lastRestDate = today();
    state.consecutiveTrainingDays = 0;
    saveState(state);
    return;
  }

  /* 2️⃣ Surprise RUN / JOG */
  if (
    daysSince(state.lastSurpriseRunDate) >= SURPRISE_RUN_MIN_DAYS &&
    !recentLegs(state.history)
  ) {
    recordDecision(state, "CARDIO", "RUN / JOG");
    show("RUN / JOG",
      "This is a rare low-pressure cardio day to refresh the system."
    );
    state.lastSurpriseRunDate = today();
    state.consecutiveTrainingDays++;
    saveState(state);
    return;
  }

  /* 3️⃣ Normal training day */
  const choice = pickMuscleGroup(state.history);
  recordDecision(state, "TRAIN", choice);
  show(choice,
    "Selected to balance muscle usage and support recovery."
  );
  state.consecutiveTrainingDays++;
  saveState(state);
}

/* =====================
   SUPPORTING RULES
===================== */

function pickMuscleGroup(history) {
  const recent = history.slice(-2).map(h => h.value);
  const options = MUSCLE_GROUPS.filter(m => !recent.includes(m));
  return options[Math.floor(Math.random() * options.length)];
}

function recentLegs(history) {
  return history.slice(-2).some(h => h.value === "LEGS");
}

function recordDecision(state, type, value) {
  state.history.push({
    date: today(),
    type,
    value
  });
}

/* =====================
   USER ACTIONS
===================== */

function skipToday() {
  const state = loadState();

  state.history.push({
    date: today(),
    type: "SKIP",
    value: "Recovery"
  });

  state.consecutiveTrainingDays = 0;
  saveState(state);

  show("RECOVERY",
    "Skipping today counts as recovery and helps long-term consistency."
  );
}

/* =====================
   UI
===================== */

function show(title, reason) {
  document.getElementById("decision").innerText = title;
  document.getElementById("reason").innerText = reason;
  updateMeta();
}

function updateMeta() {
  const state = loadState();
  const last = state.history[state.history.length - 1];
  document.getElementById("meta").innerText =
    last ? `Last: ${last.type} (${last.value})` : "";
}

updateMeta();
</script>

</body>
</html>
